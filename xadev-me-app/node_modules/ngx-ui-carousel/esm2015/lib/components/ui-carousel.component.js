/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter, Input, ContentChildren, QueryList, ElementRef, HostListener, Renderer2 } from '@angular/core';
import { UiCarouselItemComponent } from './ui-carousel-item.component';
import { UiCarouselColorConfig } from '../color-config.class';
export class UiCarouselComponent {
    /**
     * @param {?} el
     * @param {?} renderer2
     */
    constructor(el, renderer2) {
        this.el = el;
        this.renderer2 = renderer2;
        this.width = '100%';
        this.autoPlay = true;
        this.infinite = true;
        this.fade = false;
        this.isDotsVisible = true;
        this.isArrowsVisible = true;
        this.isPrintButtonVisible = false;
        this.colorConfig = new UiCarouselColorConfig();
        this.onChange = new EventEmitter();
        this.printRequest = new EventEmitter();
        this.currentItemIndex = 0;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.speed = this.speed || 500;
        this.autoPlaySpeed = this.autoPlaySpeed || 1500;
        if (this.autoPlay) {
            this.autoPlayFunction(true);
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (!this.height) {
            /** @type {?} */
            let highest = 0;
            this.items.forEach((/**
             * @param {?} itemELement
             * @return {?}
             */
            itemELement => {
                if (itemELement.el.nativeElement.offsetHeight > highest) {
                    highest = itemELement.el.nativeElement.offsetHeight;
                }
            }));
            this.height = `${highest}px`;
        }
        else {
            this.items.forEach((/**
             * @param {?} itemELement
             * @return {?}
             */
            itemELement => {
                itemELement.el.nativeElement.style.overflowY = 'auto';
            }));
        }
        this.items.forEach((/**
         * @param {?} itemELement
         * @return {?}
         */
        itemELement => {
            itemELement.el.nativeElement.style.height = this.height;
        }));
        this.el.nativeElement.style.height = this.height;
        this.el.nativeElement.style.width = this.width;
        if (this.items && this.items.length > 0) {
            this.onChange.emit(0);
            this._width = this.items.first.el.nativeElement.offsetWidth;
        }
        this.firstItemIndex = 0;
        this.lastItemIndex = this.items.length - 1;
        if (!this.fade) {
            this.items.toArray().forEach((/**
             * @param {?} item
             * @param {?} itemIndex
             * @return {?}
             */
            (item, itemIndex) => {
                item.speed = this.speed;
                item.position = this._width * itemIndex;
                item.currentPosition = item.position;
                item.disableTransition();
                item.moveTo(item.position);
            }));
        }
        else {
            this.items.forEach((/**
             * @param {?} item
             * @param {?} index
             * @return {?}
             */
            (item, index) => {
                item.zIndex = this.items.length - index;
                item.setzIndex(item.zIndex);
            }));
        }
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.items.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                item.colorConfig = this.colorConfig;
            }));
        }), 50);
    }
    /**
     * @return {?}
     */
    onPrintClick() {
        /** @type {?} */
        const currentEl = this.items.toArray()[this.currentItemIndex].el;
        this.printRequest.emit(currentEl);
    }
    /**
     * @return {?}
     */
    next() {
        this.slideRight();
    }
    /**
     * @return {?}
     */
    prev() {
        this.slideLeft();
    }
    /**
     * @param {?} index
     * @return {?}
     */
    goTo(index) {
        if (!this.fade) {
            this.slideTo(index);
        }
        else {
            this.fadeTo(index);
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    rotateRightTo(index) {
        while (index !== this.lastItemIndex) {
            this.rotateRight();
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    rotateLeftTo(index) {
        while (index !== this.firstItemIndex) {
            this.rotateLeft();
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    slideTo(index) {
        this.onChange.emit((index + this.items.length) % this.items.length);
        /** @type {?} */
        const steps = this.currentItemIndex - index;
        if (this.infinite) {
            if (steps > 0) {
                this.rotateRightTo(this.currentItemIndex);
            }
            else if (steps < 0) {
                this.rotateLeftTo(this.currentItemIndex);
            }
        }
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.enableTransition();
            this.items.forEach((/**
             * @param {?} item
             * @param {?} i
             * @return {?}
             */
            (item, i) => {
                item.position += this._width * (steps);
                item.currentPosition = item.position;
                item.moveTo(item.position);
            }));
            this.currentItemIndex = (index + this.items.length) % this.items.length;
        }), 50);
    }
    /**
     * @return {?}
     */
    slideLeft() {
        if (!this.isSliding) {
            this.isSliding = true;
            if (!this.infinite) {
                if (this.currentItemIndex === 0) {
                    this.slideToPrevPosition();
                    return;
                }
            }
            this.slideTo(this.currentItemIndex - 1);
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.isSliding = false;
            }), this.speed);
        }
    }
    /**
     * @return {?}
     */
    slideRight() {
        if (!this.isSliding) {
            this.isSliding = true;
            if (!this.infinite) {
                if (this.currentItemIndex === this.items.length - 1) {
                    this.slideToPrevPosition();
                    return;
                }
            }
            this.slideTo(this.currentItemIndex + 1);
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.isSliding = false;
            }), this.speed);
        }
    }
    /**
     * @return {?}
     */
    slideToPrevPosition() {
        this.enableTransition();
        this.items.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            item.currentPosition = item.position;
            item.moveTo(item.position);
        }));
    }
    /**
     * @return {?}
     */
    disableTransition() {
        this.items.forEach((/**
         * @param {?} item
         * @param {?} index
         * @return {?}
         */
        (item, index) => {
            item.disableTransition();
        }));
    }
    /**
     * @return {?}
     */
    enableTransition() {
        this.items.forEach((/**
         * @param {?} item
         * @param {?} index
         * @return {?}
         */
        (item, index) => {
            item.enableTransition();
        }));
    }
    /**
     * @param {?} index
     * @return {?}
     */
    getItemByIndex(index) {
        return this.items.find((/**
         * @param {?} item
         * @param {?} i
         * @return {?}
         */
        (item, i) => {
            return i === index;
        }));
    }
    /**
     * @param {?} item
     * @return {?}
     */
    getIndexByItem(item) {
        return this.items.toArray().indexOf(item);
    }
    /**
     * @param {?} n
     * @return {?}
     */
    rotateRightNTimes(n) {
        for (let i = 0; i < n; i++) {
            this.rotateRight();
        }
    }
    /**
     * @param {?} n
     * @return {?}
     */
    rotateLeftNTimes(n) {
        for (let i = 0; i < n; i++) {
            this.rotateLeft();
        }
    }
    /**
     * @return {?}
     */
    rotateRight() {
        /** @type {?} */
        const firstItemRef = this.getItemByIndex(this.firstItemIndex);
        /** @type {?} */
        const lastItemRef = this.getItemByIndex(this.lastItemIndex);
        if (!this.fade) {
            lastItemRef.position = firstItemRef.position - this._width;
            lastItemRef.currentPosition = lastItemRef.position;
            lastItemRef.disableTransition();
            lastItemRef.moveTo(lastItemRef.position);
            this.firstItemIndex = this.lastItemIndex;
            this.lastItemIndex = (this.lastItemIndex - 1 + this.items.length) % this.items.length;
        }
    }
    /**
     * @return {?}
     */
    rotateLeft() {
        /** @type {?} */
        const firstItemRef = this.getItemByIndex(this.firstItemIndex);
        /** @type {?} */
        const lastItemRef = this.getItemByIndex(this.lastItemIndex);
        firstItemRef.position = lastItemRef.position + this._width;
        firstItemRef.currentPosition = firstItemRef.position;
        firstItemRef.disableTransition();
        firstItemRef.moveTo(firstItemRef.position);
        this.lastItemIndex = this.firstItemIndex;
        this.firstItemIndex = (this.lastItemIndex + 1) % this.items.length;
    }
    /**
     * @param {?} index
     * @return {?}
     */
    fadeTo(index) {
        this.onChange.emit(index);
        /** @type {?} */
        const firstItem = this.getItemByIndex(this.currentItemIndex);
        /** @type {?} */
        const targetItem = this.getItemByIndex(index);
        /** @type {?} */
        const highestZIndex = this.items.length;
        targetItem.zIndex = firstItem.zIndex + 1;
        targetItem.setzIndex(targetItem.zIndex);
        targetItem.disableTransition();
        targetItem.fadeIn(this.speed);
        this.currentItemIndex = index;
    }
    /**
     * @return {?}
     */
    fadeRight() {
        /** @type {?} */
        const newIndex = (this.currentItemIndex + 1) % this.items.length;
        this.fadeTo(newIndex);
        this.currentItemIndex = newIndex;
    }
    /**
     * @return {?}
     */
    fadeLeft() {
        /** @type {?} */
        const newIndex = (this.currentItemIndex - 1 + this.items.length) % this.items.length;
        this.fadeTo(newIndex);
        this.currentItemIndex = newIndex;
    }
    // is item first visually and not necessary first in the dom (QueryList)
    /**
     * @param {?} index
     * @return {?}
     */
    isItemFirst(index) {
        return this.firstItemIndex === index;
    }
    // is item last visually and not necessary last in the dom (QueryList)
    /**
     * @param {?} index
     * @return {?}
     */
    isItemLast(index) {
        return this.lastItemIndex === index;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onResize(event) {
        this.rePosition();
    }
    /**
     * @return {?}
     */
    rePosition() {
        /** @type {?} */
        const items = this.items.toArray();
        if (this.items && this.items.length > 0) {
            this._width = this.items.first.el.nativeElement.offsetWidth;
        }
        items.sort((/**
         * @param {?} item1
         * @param {?} item2
         * @return {?}
         */
        (item1, item2) => {
            if (item1.position > item2.position) {
                return 1;
            }
            else if (item1.position < item2.position) {
                return -1;
            }
            else {
                return 0;
            }
        }));
        /** @type {?} */
        const currentItem = this.getItemByIndex(this.currentItemIndex);
        /** @type {?} */
        const currentItemIndex = items.indexOf(currentItem);
        for (let i = currentItemIndex; i < items.length + currentItemIndex; i++) {
            /** @type {?} */
            const item = items[(i + items.length) % items.length];
            item.position = ((i + items.length) % items.length - currentItemIndex) * this._width;
            item.disableTransition();
            item.moveTo(item.position);
        }
    }
    /**
     * @param {?} shouldAutoPlay
     * @return {?}
     */
    autoPlayFunction(shouldAutoPlay) {
        if (this.autoPlay) {
            if (shouldAutoPlay) {
                this.interval = setInterval((/**
                 * @return {?}
                 */
                () => {
                    this.next();
                }), this.autoPlaySpeed);
            }
            else {
                clearInterval(this.interval);
            }
        }
    }
}
UiCarouselComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'ngx-ui-carousel',
                template: `
    <div (mouseenter)="(autoPlay)?autoPlayFunction(false):null" (mouseleave)="(autoPlay)?autoPlayFunction(true):null">
      <ng-content></ng-content>
      <dots
        *ngIf="isDotsVisible && items.length > 1"
        [dotsCount]="items.length"
        position="middle"
        [activeDot]="currentItemIndex"
        [colorConfig]="colorConfig"
        (onClick)="goTo($event)"></dots>
      <arrow *ngIf="isArrowsVisible && items.length > 1" dir="left" (onArrowClick)="prev()" [disabled]="false" [colorConfig]="colorConfig"></arrow>
      <arrow *ngIf="isArrowsVisible && items.length > 1" dir="right" (onArrowClick)="next()" [disabled]="false" [colorConfig]="colorConfig"></arrow>
      <print-button
        *ngIf="isPrintButtonVisible"
        (onButtonClick)="onPrintClick()"
        [colorConfig]="colorConfig"
        [disabled]="false"></print-button>
    </div>
  `,
                styles: [`
    :host {
      display: block;
      overflow: hidden;
      position: relative;
    }
  `]
            }] }
];
/** @nocollapse */
UiCarouselComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
UiCarouselComponent.propDecorators = {
    height: [{ type: Input }],
    width: [{ type: Input }],
    speed: [{ type: Input }],
    autoPlay: [{ type: Input }],
    autoPlaySpeed: [{ type: Input }],
    infinite: [{ type: Input }],
    fade: [{ type: Input }],
    isDotsVisible: [{ type: Input }],
    isArrowsVisible: [{ type: Input }],
    isPrintButtonVisible: [{ type: Input }],
    colorConfig: [{ type: Input }],
    onChange: [{ type: Output }],
    printRequest: [{ type: Output }],
    items: [{ type: ContentChildren, args: [UiCarouselItemComponent,] }],
    onResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    UiCarouselComponent.prototype.height;
    /** @type {?} */
    UiCarouselComponent.prototype.width;
    /** @type {?} */
    UiCarouselComponent.prototype.speed;
    /** @type {?} */
    UiCarouselComponent.prototype.autoPlay;
    /** @type {?} */
    UiCarouselComponent.prototype.autoPlaySpeed;
    /** @type {?} */
    UiCarouselComponent.prototype.infinite;
    /** @type {?} */
    UiCarouselComponent.prototype.fade;
    /** @type {?} */
    UiCarouselComponent.prototype.isDotsVisible;
    /** @type {?} */
    UiCarouselComponent.prototype.isArrowsVisible;
    /** @type {?} */
    UiCarouselComponent.prototype.isPrintButtonVisible;
    /** @type {?} */
    UiCarouselComponent.prototype.colorConfig;
    /** @type {?} */
    UiCarouselComponent.prototype.onChange;
    /** @type {?} */
    UiCarouselComponent.prototype.printRequest;
    /** @type {?} */
    UiCarouselComponent.prototype.items;
    /** @type {?} */
    UiCarouselComponent.prototype.currentItemIndex;
    /** @type {?} */
    UiCarouselComponent.prototype.interval;
    /**
     * @type {?}
     * @private
     */
    UiCarouselComponent.prototype._width;
    /**
     * @type {?}
     * @private
     */
    UiCarouselComponent.prototype.firstItemIndex;
    /**
     * @type {?}
     * @private
     */
    UiCarouselComponent.prototype.lastItemIndex;
    /**
     * @type {?}
     * @private
     */
    UiCarouselComponent.prototype.isSliding;
    /**
     * @type {?}
     * @private
     */
    UiCarouselComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    UiCarouselComponent.prototype.renderer2;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWktY2Fyb3VzZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXVpLWNhcm91c2VsLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvdWktY2Fyb3VzZWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQ3ZDLEtBQUssRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFDN0MsWUFBWSxFQUFpQixTQUFTLEVBQ3ZDLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBZ0M5RCxNQUFNLE9BQU8sbUJBQW1COzs7OztJQTBCOUIsWUFBb0IsRUFBYyxFQUFVLFNBQW9CO1FBQTVDLE9BQUUsR0FBRixFQUFFLENBQVk7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBeEJ2RCxVQUFLLEdBQUcsTUFBTSxDQUFDO1FBRWYsYUFBUSxHQUFHLElBQUksQ0FBQztRQUVoQixhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLFNBQUksR0FBRyxLQUFLLENBQUM7UUFDYixrQkFBYSxHQUFHLElBQUksQ0FBQztRQUNyQixvQkFBZSxHQUFHLElBQUksQ0FBQztRQUN2Qix5QkFBb0IsR0FBRyxLQUFLLENBQUM7UUFDN0IsZ0JBQVcsR0FBRyxJQUFJLHFCQUFxQixFQUFFLENBQUM7UUFFekMsYUFBUSxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3RELGlCQUFZLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFJN0QscUJBQWdCLEdBQUcsQ0FBQyxDQUFDO0lBUXdDLENBQUM7Ozs7SUFFckUsUUFBUTtRQUNOLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssSUFBSSxHQUFHLENBQUM7UUFDL0Is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O29CQUNMLEtBQUs7b0JBQ0wsS0FBSzt1QkFDTCxLQUFLOzRCQUNMLEtBQUs7dUJBQ0wsS0FBSzttQkFDTCxLQUFLOzRCQUNMLEtBQUs7OEJBQ0wsS0FBSzttQ0FDTCxLQUFLOzBCQUNMLEtBQUs7dUJBRUwsTUFBTTsyQkFDTixNQUFNO29CQUVOLGVBQWUsU0FBQyx1QkFBdUI7dUJBZ1F2QyxZQUFZLFNBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDOzs7O0lBL1F6QyxxQ0FBd0I7O0lBQ3hCLG9DQUF3Qjs7SUFDeEIsb0NBQXVCOztJQUN2Qix1Q0FBeUI7O0lBQ3pCLDRDQUErQjs7SUFDL0IsdUNBQXlCOztJQUN6QixtQ0FBc0I7O0lBQ3RCLDRDQUE4Qjs7SUFDOUIsOENBQWdDOztJQUNoQyxtREFBc0M7O0lBQ3RDLDBDQUFtRDs7SUFFbkQsdUNBQWdFOztJQUNoRSwyQ0FBb0U7O0lBRXBFLG9DQUFvRjs7SUFFcEYsK0NBQTRCOztJQUM1Qix1Q0FBcUI7Ozs7O0lBRXJCLHFDQUF1Qjs7Ozs7SUFDdkIsNkNBQStCOzs7OztJQUMvQiw0Q0FBOEI7Ozs7O0lBQzlCLHdDQUEyQjs7Ozs7SUFFZixpQ0FBc0I7Ozs7O0lBQUUsd0NBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb21wb25lbnQsIE9uSW5pdCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsXHJcbiAgSW5wdXQsIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0LCBFbGVtZW50UmVmLFxyXG4gIEhvc3RMaXN0ZW5lciwgQWZ0ZXJWaWV3SW5pdCwgUmVuZGVyZXIyXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFVpQ2Fyb3VzZWxJdGVtQ29tcG9uZW50IH0gZnJvbSAnLi91aS1jYXJvdXNlbC1pdGVtLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFVpQ2Fyb3VzZWxDb2xvckNvbmZpZyB9IGZyb20gJy4uL2NvbG9yLWNvbmZpZy5jbGFzcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXHJcbiAgc2VsZWN0b3I6ICduZ3gtdWktY2Fyb3VzZWwnLFxyXG4gIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2IChtb3VzZWVudGVyKT1cIihhdXRvUGxheSk/YXV0b1BsYXlGdW5jdGlvbihmYWxzZSk6bnVsbFwiIChtb3VzZWxlYXZlKT1cIihhdXRvUGxheSk/YXV0b1BsYXlGdW5jdGlvbih0cnVlKTpudWxsXCI+XHJcbiAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cclxuICAgICAgPGRvdHNcclxuICAgICAgICAqbmdJZj1cImlzRG90c1Zpc2libGUgJiYgaXRlbXMubGVuZ3RoID4gMVwiXHJcbiAgICAgICAgW2RvdHNDb3VudF09XCJpdGVtcy5sZW5ndGhcIlxyXG4gICAgICAgIHBvc2l0aW9uPVwibWlkZGxlXCJcclxuICAgICAgICBbYWN0aXZlRG90XT1cImN1cnJlbnRJdGVtSW5kZXhcIlxyXG4gICAgICAgIFtjb2xvckNvbmZpZ109XCJjb2xvckNvbmZpZ1wiXHJcbiAgICAgICAgKG9uQ2xpY2spPVwiZ29UbygkZXZlbnQpXCI+PC9kb3RzPlxyXG4gICAgICA8YXJyb3cgKm5nSWY9XCJpc0Fycm93c1Zpc2libGUgJiYgaXRlbXMubGVuZ3RoID4gMVwiIGRpcj1cImxlZnRcIiAob25BcnJvd0NsaWNrKT1cInByZXYoKVwiIFtkaXNhYmxlZF09XCJmYWxzZVwiIFtjb2xvckNvbmZpZ109XCJjb2xvckNvbmZpZ1wiPjwvYXJyb3c+XHJcbiAgICAgIDxhcnJvdyAqbmdJZj1cImlzQXJyb3dzVmlzaWJsZSAmJiBpdGVtcy5sZW5ndGggPiAxXCIgZGlyPVwicmlnaHRcIiAob25BcnJvd0NsaWNrKT1cIm5leHQoKVwiIFtkaXNhYmxlZF09XCJmYWxzZVwiIFtjb2xvckNvbmZpZ109XCJjb2xvckNvbmZpZ1wiPjwvYXJyb3c+XHJcbiAgICAgIDxwcmludC1idXR0b25cclxuICAgICAgICAqbmdJZj1cImlzUHJpbnRCdXR0b25WaXNpYmxlXCJcclxuICAgICAgICAob25CdXR0b25DbGljayk9XCJvblByaW50Q2xpY2soKVwiXHJcbiAgICAgICAgW2NvbG9yQ29uZmlnXT1cImNvbG9yQ29uZmlnXCJcclxuICAgICAgICBbZGlzYWJsZWRdPVwiZmFsc2VcIj48L3ByaW50LWJ1dHRvbj5cclxuICAgIDwvZGl2PlxyXG4gIGAsXHJcbiAgc3R5bGVzOiBbYFxyXG4gICAgOmhvc3Qge1xyXG4gICAgICBkaXNwbGF5OiBibG9jaztcclxuICAgICAgb3ZlcmZsb3c6IGhpZGRlbjtcclxuICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xyXG4gICAgfVxyXG4gIGBdLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgVWlDYXJvdXNlbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgQElucHV0KCkgaGVpZ2h0OiBzdHJpbmc7XHJcbiAgQElucHV0KCkgd2lkdGggPSAnMTAwJSc7XHJcbiAgQElucHV0KCkgc3BlZWQ6IG51bWJlcjtcclxuICBASW5wdXQoKSBhdXRvUGxheSA9IHRydWU7XHJcbiAgQElucHV0KCkgYXV0b1BsYXlTcGVlZDogbnVtYmVyO1xyXG4gIEBJbnB1dCgpIGluZmluaXRlID0gdHJ1ZTtcclxuICBASW5wdXQoKSBmYWRlID0gZmFsc2U7XHJcbiAgQElucHV0KCkgaXNEb3RzVmlzaWJsZSA9IHRydWU7XHJcbiAgQElucHV0KCkgaXNBcnJvd3NWaXNpYmxlID0gdHJ1ZTtcclxuICBASW5wdXQoKSBpc1ByaW50QnV0dG9uVmlzaWJsZSA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIGNvbG9yQ29uZmlnID0gbmV3IFVpQ2Fyb3VzZWxDb2xvckNvbmZpZygpO1xyXG5cclxuICBAT3V0cHV0KCkgb25DaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgQE91dHB1dCgpIHByaW50UmVxdWVzdDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgQENvbnRlbnRDaGlsZHJlbihVaUNhcm91c2VsSXRlbUNvbXBvbmVudCkgaXRlbXM6IFF1ZXJ5TGlzdDxVaUNhcm91c2VsSXRlbUNvbXBvbmVudD47XHJcblxyXG4gIHB1YmxpYyBjdXJyZW50SXRlbUluZGV4ID0gMDtcclxuICBwdWJsaWMgaW50ZXJ2YWw6IGFueTtcclxuXHJcbiAgcHJpdmF0ZSBfd2lkdGg6IG51bWJlcjtcclxuICBwcml2YXRlIGZpcnN0SXRlbUluZGV4OiBudW1iZXI7IC8vIHRoZSB2aXN1YWwgaW5kZXggb2YgaXRlbSBhbmQgbm90IG5lY2Vzc2FyeSB0aGUgaW5kZXggaW4gdGhlIERPTVxyXG4gIHByaXZhdGUgbGFzdEl0ZW1JbmRleDogbnVtYmVyOyAvLyAuLlxyXG4gIHByaXZhdGUgaXNTbGlkaW5nOiBib29sZWFuO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIHJlbmRlcmVyMjogUmVuZGVyZXIyKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLnNwZWVkID0gdGhpcy5zcGVlZCB8fCA1MDA7XHJcbiAgICB0aGlzLmF1dG9QbGF5U3BlZWQgPSB0aGlzLmF1dG9QbGF5U3BlZWQgfHwgMTUwMDtcclxuICAgIGlmICh0aGlzLmF1dG9QbGF5KSB7XHJcbiAgICAgIHRoaXMuYXV0b1BsYXlGdW5jdGlvbih0cnVlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIGlmICghdGhpcy5oZWlnaHQpIHtcclxuICAgICAgbGV0IGhpZ2hlc3QgPSAwO1xyXG4gICAgICB0aGlzLml0ZW1zLmZvckVhY2goaXRlbUVMZW1lbnQgPT4ge1xyXG4gICAgICAgIGlmIChpdGVtRUxlbWVudC5lbC5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodCA+IGhpZ2hlc3QpIHtcclxuICAgICAgICAgIGhpZ2hlc3QgPSBpdGVtRUxlbWVudC5lbC5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgdGhpcy5oZWlnaHQgPSBgJHtoaWdoZXN0fXB4YDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaChpdGVtRUxlbWVudCA9PiB7XHJcbiAgICAgICAgaXRlbUVMZW1lbnQuZWwubmF0aXZlRWxlbWVudC5zdHlsZS5vdmVyZmxvd1kgPSAnYXV0byc7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaXRlbXMuZm9yRWFjaChpdGVtRUxlbWVudCA9PiB7XHJcbiAgICAgIGl0ZW1FTGVtZW50LmVsLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XHJcbiAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc3R5bGUud2lkdGggPSB0aGlzLndpZHRoO1xyXG4gICAgaWYgKHRoaXMuaXRlbXMgJiYgdGhpcy5pdGVtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMub25DaGFuZ2UuZW1pdCgwKTtcclxuICAgICAgdGhpcy5fd2lkdGggPSB0aGlzLml0ZW1zLmZpcnN0LmVsLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XHJcbiAgICB9XHJcbiAgICB0aGlzLmZpcnN0SXRlbUluZGV4ID0gMDtcclxuICAgIHRoaXMubGFzdEl0ZW1JbmRleCA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gMTtcclxuICAgIGlmICghdGhpcy5mYWRlKSB7XHJcbiAgICAgIHRoaXMuaXRlbXMudG9BcnJheSgpLmZvckVhY2goKGl0ZW0sIGl0ZW1JbmRleCkgPT4ge1xyXG4gICAgICAgIGl0ZW0uc3BlZWQgPSB0aGlzLnNwZWVkO1xyXG4gICAgICAgIGl0ZW0ucG9zaXRpb24gPSB0aGlzLl93aWR0aCAqIGl0ZW1JbmRleDtcclxuICAgICAgICBpdGVtLmN1cnJlbnRQb3NpdGlvbiA9IGl0ZW0ucG9zaXRpb247XHJcbiAgICAgICAgaXRlbS5kaXNhYmxlVHJhbnNpdGlvbigpO1xyXG4gICAgICAgIGl0ZW0ubW92ZVRvKGl0ZW0ucG9zaXRpb24pO1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICBpdGVtLnpJbmRleCA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gaW5kZXg7XHJcbiAgICAgICAgaXRlbS5zZXR6SW5kZXgoaXRlbS56SW5kZXgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLml0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgaXRlbS5jb2xvckNvbmZpZyA9IHRoaXMuY29sb3JDb25maWc7XHJcbiAgICAgIH0pO1xyXG4gICAgfSwgNTApO1xyXG4gIH1cclxuXHJcbiAgb25QcmludENsaWNrKCkge1xyXG4gICAgY29uc3QgY3VycmVudEVsID0gdGhpcy5pdGVtcy50b0FycmF5KClbdGhpcy5jdXJyZW50SXRlbUluZGV4XS5lbDtcclxuICAgIHRoaXMucHJpbnRSZXF1ZXN0LmVtaXQoY3VycmVudEVsKTtcclxuICB9XHJcblxyXG4gIG5leHQoKSB7XHJcbiAgICB0aGlzLnNsaWRlUmlnaHQoKTtcclxuICB9XHJcblxyXG4gIHByZXYoKSB7XHJcbiAgICB0aGlzLnNsaWRlTGVmdCgpO1xyXG4gIH1cclxuXHJcbiAgZ29UbyhpbmRleDogbnVtYmVyKSB7XHJcbiAgICBpZiAoIXRoaXMuZmFkZSkge1xyXG4gICAgICB0aGlzLnNsaWRlVG8oaW5kZXgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5mYWRlVG8oaW5kZXgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcm90YXRlUmlnaHRUbyhpbmRleDogbnVtYmVyKSB7XHJcbiAgICB3aGlsZSAoaW5kZXggIT09IHRoaXMubGFzdEl0ZW1JbmRleCkge1xyXG4gICAgICB0aGlzLnJvdGF0ZVJpZ2h0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByb3RhdGVMZWZ0VG8oaW5kZXg6IG51bWJlcikge1xyXG4gICAgd2hpbGUgKGluZGV4ICE9PSB0aGlzLmZpcnN0SXRlbUluZGV4KSB7XHJcbiAgICAgIHRoaXMucm90YXRlTGVmdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2xpZGVUbyhpbmRleDogbnVtYmVyKSB7XHJcbiAgICB0aGlzLm9uQ2hhbmdlLmVtaXQoKGluZGV4ICsgdGhpcy5pdGVtcy5sZW5ndGgpICUgdGhpcy5pdGVtcy5sZW5ndGgpO1xyXG4gICAgY29uc3Qgc3RlcHMgPSB0aGlzLmN1cnJlbnRJdGVtSW5kZXggLSBpbmRleDtcclxuICAgIGlmICh0aGlzLmluZmluaXRlKSB7XHJcbiAgICAgIGlmIChzdGVwcyA+IDApIHtcclxuICAgICAgICB0aGlzLnJvdGF0ZVJpZ2h0VG8odGhpcy5jdXJyZW50SXRlbUluZGV4KTtcclxuICAgICAgfSBlbHNlIGlmIChzdGVwcyA8IDApIHtcclxuICAgICAgICB0aGlzLnJvdGF0ZUxlZnRUbyh0aGlzLmN1cnJlbnRJdGVtSW5kZXgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy5lbmFibGVUcmFuc2l0aW9uKCk7XHJcbiAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaCgoaXRlbSwgaSkgPT4ge1xyXG4gICAgICAgIGl0ZW0ucG9zaXRpb24gKz0gdGhpcy5fd2lkdGggKiAoc3RlcHMpO1xyXG4gICAgICAgIGl0ZW0uY3VycmVudFBvc2l0aW9uID0gaXRlbS5wb3NpdGlvbjtcclxuICAgICAgICBpdGVtLm1vdmVUbyhpdGVtLnBvc2l0aW9uKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuY3VycmVudEl0ZW1JbmRleCA9IChpbmRleCArIHRoaXMuaXRlbXMubGVuZ3RoKSAlIHRoaXMuaXRlbXMubGVuZ3RoO1xyXG4gICAgfSwgNTApO1xyXG4gIH1cclxuXHJcbiAgc2xpZGVMZWZ0KCkge1xyXG4gICAgaWYgKCF0aGlzLmlzU2xpZGluZykge1xyXG4gICAgICB0aGlzLmlzU2xpZGluZyA9IHRydWU7XHJcbiAgICAgIGlmICghdGhpcy5pbmZpbml0ZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRJdGVtSW5kZXggPT09IDApIHtcclxuICAgICAgICAgIHRoaXMuc2xpZGVUb1ByZXZQb3NpdGlvbigpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzLnNsaWRlVG8odGhpcy5jdXJyZW50SXRlbUluZGV4IC0gMSk7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuaXNTbGlkaW5nID0gZmFsc2U7XHJcbiAgICAgIH0sIHRoaXMuc3BlZWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2xpZGVSaWdodCgpIHtcclxuICAgIGlmICghdGhpcy5pc1NsaWRpbmcpIHtcclxuICAgICAgdGhpcy5pc1NsaWRpbmcgPSB0cnVlO1xyXG4gICAgICBpZiAoIXRoaXMuaW5maW5pdGUpIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50SXRlbUluZGV4ID09PSB0aGlzLml0ZW1zLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgIHRoaXMuc2xpZGVUb1ByZXZQb3NpdGlvbigpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzLnNsaWRlVG8odGhpcy5jdXJyZW50SXRlbUluZGV4ICsgMSk7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuaXNTbGlkaW5nID0gZmFsc2U7XHJcbiAgICAgIH0sIHRoaXMuc3BlZWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2xpZGVUb1ByZXZQb3NpdGlvbigpIHtcclxuICAgIHRoaXMuZW5hYmxlVHJhbnNpdGlvbigpO1xyXG4gICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICBpdGVtLmN1cnJlbnRQb3NpdGlvbiA9IGl0ZW0ucG9zaXRpb247XHJcbiAgICAgIGl0ZW0ubW92ZVRvKGl0ZW0ucG9zaXRpb24pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBkaXNhYmxlVHJhbnNpdGlvbigpIHtcclxuICAgIHRoaXMuaXRlbXMuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgaXRlbS5kaXNhYmxlVHJhbnNpdGlvbigpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlbmFibGVUcmFuc2l0aW9uKCkge1xyXG4gICAgdGhpcy5pdGVtcy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICBpdGVtLmVuYWJsZVRyYW5zaXRpb24oKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0SXRlbUJ5SW5kZXgoaW5kZXg6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIHRoaXMuaXRlbXMuZmluZCgoaXRlbSwgaSkgPT4ge1xyXG4gICAgICByZXR1cm4gaSA9PT0gaW5kZXg7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldEluZGV4QnlJdGVtKGl0ZW06IFVpQ2Fyb3VzZWxJdGVtQ29tcG9uZW50KSB7XHJcbiAgICByZXR1cm4gdGhpcy5pdGVtcy50b0FycmF5KCkuaW5kZXhPZihpdGVtKTtcclxuICB9XHJcblxyXG4gIHJvdGF0ZVJpZ2h0TlRpbWVzKG46IG51bWJlcikge1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHtcclxuICAgICAgdGhpcy5yb3RhdGVSaWdodCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcm90YXRlTGVmdE5UaW1lcyhuOiBudW1iZXIpIHtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgIHRoaXMucm90YXRlTGVmdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcm90YXRlUmlnaHQoKSB7XHJcbiAgICBjb25zdCBmaXJzdEl0ZW1SZWYgPSB0aGlzLmdldEl0ZW1CeUluZGV4KHRoaXMuZmlyc3RJdGVtSW5kZXgpO1xyXG4gICAgY29uc3QgbGFzdEl0ZW1SZWYgPSB0aGlzLmdldEl0ZW1CeUluZGV4KHRoaXMubGFzdEl0ZW1JbmRleCk7XHJcblxyXG4gICAgaWYgKCF0aGlzLmZhZGUpIHtcclxuICAgICAgbGFzdEl0ZW1SZWYucG9zaXRpb24gPSBmaXJzdEl0ZW1SZWYucG9zaXRpb24gLSB0aGlzLl93aWR0aDtcclxuICAgICAgbGFzdEl0ZW1SZWYuY3VycmVudFBvc2l0aW9uID0gbGFzdEl0ZW1SZWYucG9zaXRpb247XHJcbiAgICAgIGxhc3RJdGVtUmVmLmRpc2FibGVUcmFuc2l0aW9uKCk7XHJcbiAgICAgIGxhc3RJdGVtUmVmLm1vdmVUbyhsYXN0SXRlbVJlZi5wb3NpdGlvbik7XHJcbiAgICAgIHRoaXMuZmlyc3RJdGVtSW5kZXggPSB0aGlzLmxhc3RJdGVtSW5kZXg7XHJcbiAgICAgIHRoaXMubGFzdEl0ZW1JbmRleCA9ICh0aGlzLmxhc3RJdGVtSW5kZXggLSAxICsgdGhpcy5pdGVtcy5sZW5ndGgpICUgdGhpcy5pdGVtcy5sZW5ndGg7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByb3RhdGVMZWZ0KCkge1xyXG4gICAgY29uc3QgZmlyc3RJdGVtUmVmID0gdGhpcy5nZXRJdGVtQnlJbmRleCh0aGlzLmZpcnN0SXRlbUluZGV4KTtcclxuICAgIGNvbnN0IGxhc3RJdGVtUmVmID0gdGhpcy5nZXRJdGVtQnlJbmRleCh0aGlzLmxhc3RJdGVtSW5kZXgpO1xyXG4gICAgZmlyc3RJdGVtUmVmLnBvc2l0aW9uID0gbGFzdEl0ZW1SZWYucG9zaXRpb24gKyB0aGlzLl93aWR0aDtcclxuICAgIGZpcnN0SXRlbVJlZi5jdXJyZW50UG9zaXRpb24gPSBmaXJzdEl0ZW1SZWYucG9zaXRpb247XHJcbiAgICBmaXJzdEl0ZW1SZWYuZGlzYWJsZVRyYW5zaXRpb24oKTtcclxuICAgIGZpcnN0SXRlbVJlZi5tb3ZlVG8oZmlyc3RJdGVtUmVmLnBvc2l0aW9uKTtcclxuICAgIHRoaXMubGFzdEl0ZW1JbmRleCA9IHRoaXMuZmlyc3RJdGVtSW5kZXg7XHJcbiAgICB0aGlzLmZpcnN0SXRlbUluZGV4ID0gKHRoaXMubGFzdEl0ZW1JbmRleCArIDEpICUgdGhpcy5pdGVtcy5sZW5ndGg7XHJcbiAgfVxyXG5cclxuICBmYWRlVG8oaW5kZXg6IG51bWJlcikge1xyXG4gICAgdGhpcy5vbkNoYW5nZS5lbWl0KGluZGV4KTtcclxuICAgIGNvbnN0IGZpcnN0SXRlbSA9IHRoaXMuZ2V0SXRlbUJ5SW5kZXgodGhpcy5jdXJyZW50SXRlbUluZGV4KTtcclxuICAgIGNvbnN0IHRhcmdldEl0ZW0gPSB0aGlzLmdldEl0ZW1CeUluZGV4KGluZGV4KTtcclxuICAgIGNvbnN0IGhpZ2hlc3RaSW5kZXggPSB0aGlzLml0ZW1zLmxlbmd0aDtcclxuICAgIHRhcmdldEl0ZW0uekluZGV4ID0gZmlyc3RJdGVtLnpJbmRleCArIDE7XHJcbiAgICB0YXJnZXRJdGVtLnNldHpJbmRleCh0YXJnZXRJdGVtLnpJbmRleCk7XHJcbiAgICB0YXJnZXRJdGVtLmRpc2FibGVUcmFuc2l0aW9uKCk7XHJcbiAgICB0YXJnZXRJdGVtLmZhZGVJbih0aGlzLnNwZWVkKTtcclxuICAgIHRoaXMuY3VycmVudEl0ZW1JbmRleCA9IGluZGV4O1xyXG4gIH1cclxuXHJcbiAgZmFkZVJpZ2h0KCkge1xyXG4gICAgY29uc3QgbmV3SW5kZXggPSAodGhpcy5jdXJyZW50SXRlbUluZGV4ICsgMSkgJSB0aGlzLml0ZW1zLmxlbmd0aDtcclxuICAgIHRoaXMuZmFkZVRvKG5ld0luZGV4KTtcclxuICAgIHRoaXMuY3VycmVudEl0ZW1JbmRleCA9IG5ld0luZGV4O1xyXG4gIH1cclxuXHJcbiAgZmFkZUxlZnQoKSB7XHJcbiAgICBjb25zdCBuZXdJbmRleCA9ICh0aGlzLmN1cnJlbnRJdGVtSW5kZXggLSAxICsgdGhpcy5pdGVtcy5sZW5ndGgpICUgdGhpcy5pdGVtcy5sZW5ndGg7XHJcbiAgICB0aGlzLmZhZGVUbyhuZXdJbmRleCk7XHJcbiAgICB0aGlzLmN1cnJlbnRJdGVtSW5kZXggPSBuZXdJbmRleDtcclxuICB9XHJcblxyXG4gIC8vIGlzIGl0ZW0gZmlyc3QgdmlzdWFsbHkgYW5kIG5vdCBuZWNlc3NhcnkgZmlyc3QgaW4gdGhlIGRvbSAoUXVlcnlMaXN0KVxyXG4gIGlzSXRlbUZpcnN0KGluZGV4OiBudW1iZXIpIHtcclxuICAgIHJldHVybiB0aGlzLmZpcnN0SXRlbUluZGV4ID09PSBpbmRleDtcclxuICB9XHJcblxyXG4gIC8vIGlzIGl0ZW0gbGFzdCB2aXN1YWxseSBhbmQgbm90IG5lY2Vzc2FyeSBsYXN0IGluIHRoZSBkb20gKFF1ZXJ5TGlzdClcclxuICBpc0l0ZW1MYXN0KGluZGV4OiBudW1iZXIpIHtcclxuICAgIHJldHVybiB0aGlzLmxhc3RJdGVtSW5kZXggPT09IGluZGV4O1xyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScsIFsnJGV2ZW50J10pXHJcbiAgb25SZXNpemUoZXZlbnQ6IGFueSkge1xyXG4gICAgdGhpcy5yZVBvc2l0aW9uKCk7XHJcbiAgfVxyXG5cclxuICByZVBvc2l0aW9uKCkge1xyXG4gICAgY29uc3QgaXRlbXMgPSB0aGlzLml0ZW1zLnRvQXJyYXkoKTtcclxuXHJcbiAgICBpZiAodGhpcy5pdGVtcyAmJiB0aGlzLml0ZW1zLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5fd2lkdGggPSB0aGlzLml0ZW1zLmZpcnN0LmVsLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XHJcbiAgICB9XHJcblxyXG4gICAgaXRlbXMuc29ydCgoaXRlbTEsIGl0ZW0yKSA9PiB7XHJcbiAgICAgIGlmIChpdGVtMS5wb3NpdGlvbiA+IGl0ZW0yLnBvc2l0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgIH0gZWxzZSBpZiAoaXRlbTEucG9zaXRpb24gPCBpdGVtMi5wb3NpdGlvbikge1xyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgY3VycmVudEl0ZW0gPSB0aGlzLmdldEl0ZW1CeUluZGV4KHRoaXMuY3VycmVudEl0ZW1JbmRleCk7XHJcbiAgICBjb25zdCBjdXJyZW50SXRlbUluZGV4ID0gaXRlbXMuaW5kZXhPZihjdXJyZW50SXRlbSk7XHJcbiAgICBmb3IgKGxldCBpID0gY3VycmVudEl0ZW1JbmRleDsgaSA8IGl0ZW1zLmxlbmd0aCArIGN1cnJlbnRJdGVtSW5kZXg7IGkrKykge1xyXG4gICAgICBjb25zdCBpdGVtID0gaXRlbXNbKGkgKyBpdGVtcy5sZW5ndGgpICUgaXRlbXMubGVuZ3RoXTtcclxuICAgICAgaXRlbS5wb3NpdGlvbiA9ICgoaSArIGl0ZW1zLmxlbmd0aCkgJSBpdGVtcy5sZW5ndGggLSBjdXJyZW50SXRlbUluZGV4KSAqIHRoaXMuX3dpZHRoO1xyXG4gICAgICBpdGVtLmRpc2FibGVUcmFuc2l0aW9uKCk7XHJcbiAgICAgIGl0ZW0ubW92ZVRvKGl0ZW0ucG9zaXRpb24pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXV0b1BsYXlGdW5jdGlvbihzaG91bGRBdXRvUGxheTogYm9vbGVhbikge1xyXG4gICAgaWYgKHRoaXMuYXV0b1BsYXkpIHtcclxuICAgICAgaWYgKHNob3VsZEF1dG9QbGF5KSB7XHJcbiAgICAgICAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMubmV4dCgpO1xyXG4gICAgICAgIH0sIHRoaXMuYXV0b1BsYXlTcGVlZCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuIl19